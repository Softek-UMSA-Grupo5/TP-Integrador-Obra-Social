


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > MedicamentoService</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.softek.g5.services</a>
</div>

<h1>Coverage Summary for Class: MedicamentoService (org.softek.g5.services)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MedicamentoService</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    40%
  </span>
  <span class="absValue">
    (2/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    14,8%
  </span>
  <span class="absValue">
    (8/54)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.softek.g5.services;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collection;
&nbsp;import java.util.List;
&nbsp;import java.util.Optional;
&nbsp;
&nbsp;import org.softek.g5.entities.medicamento.Medicamento;
&nbsp;import org.softek.g5.entities.medicamento.MedicamentoFactory;
&nbsp;import org.softek.g5.entities.medicamento.dto.MedicamentoRequestDto;
&nbsp;import org.softek.g5.entities.medicamento.dto.MedicamentoResponseDto;
&nbsp;import org.softek.g5.entities.recetaMedica.RecetaMedica;
&nbsp;import org.softek.g5.exceptions.CustomException.CustomServerException;
&nbsp;import org.softek.g5.exceptions.CustomException.EntityNotFoundException;
&nbsp;import org.softek.g5.exceptions.CustomException.InvalidDataRequest;
&nbsp;import org.softek.g5.repositories.MedicamentoRepository;
&nbsp;import org.softek.g5.repositories.RecetaMedicaRepository;
&nbsp;import org.softek.g5.validation.DataValidator;
&nbsp;import org.softek.g5.validation.entitiesValidation.MedicamentoValidator;
&nbsp;
&nbsp;import jakarta.enterprise.context.ApplicationScoped;
&nbsp;import jakarta.inject.Inject;
&nbsp;import jakarta.transaction.Transactional;
&nbsp;import lombok.AllArgsConstructor;
&nbsp;
&nbsp;@ApplicationScoped
<b class="fc">&nbsp;@AllArgsConstructor</b>
&nbsp;public class MedicamentoService {
&nbsp;
&nbsp;	@Inject
&nbsp;	MedicamentoRepository medicamentoRepository;
&nbsp;
&nbsp;	@Inject
&nbsp;	MedicamentoFactory medicamentoFactory;
&nbsp;
&nbsp;	@Inject
&nbsp;	RecetaMedicaRepository recetaMedicaRepository;
&nbsp;
&nbsp;	@Transactional
&nbsp;	public List&lt;MedicamentoResponseDto&gt; getMedicamentos() throws CustomServerException {
&nbsp;		try {
<b class="fc">&nbsp;			Collection&lt;Medicamento&gt; medicamentos = medicamentoRepository.listAll();</b>
&nbsp;
<b class="fc">&nbsp;			if (medicamentos.isEmpty()) {</b>
<b class="nc">&nbsp;				throw new EntityNotFoundException(&quot;No hay registros de medicamentos&quot;);</b>
&nbsp;			}
&nbsp;
<b class="fc">&nbsp;			List&lt;MedicamentoResponseDto&gt; dtos = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;			for (Medicamento m : medicamentos) {</b>
<b class="fc">&nbsp;				dtos.add(medicamentoFactory.createResponseFromEntity(m));</b>
<b class="fc">&nbsp;			}</b>
&nbsp;
<b class="fc">&nbsp;			return dtos;</b>
<b class="nc">&nbsp;		} catch (CustomServerException e) {</b>
<b class="nc">&nbsp;			throw new CustomServerException(&quot;Error al obtener los medicamentos&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	@Transactional
&nbsp;	public Collection&lt;MedicamentoResponseDto&gt; persistMedicamento(String codigoReceta, List&lt;MedicamentoRequestDto&gt; dtos)
&nbsp;			throws CustomServerException {
&nbsp;
&nbsp;		try {
&nbsp;
<b class="nc">&nbsp;			Collection&lt;MedicamentoResponseDto&gt; response = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;			for (MedicamentoRequestDto dto : dtos) {</b>
&nbsp;
<b class="nc">&nbsp;				DataValidator.validateDtoFields(dto);</b>
&nbsp;
<b class="nc">&nbsp;				if (!MedicamentoValidator.validateRequestDto(dto)) {</b>
<b class="nc">&nbsp;					throw new InvalidDataRequest(&quot;Los datos de medicamento enviados son erroneos&quot;);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				Medicamento medicamento = medicamentoFactory.createEntityFromDto(dto);</b>
&nbsp;
<b class="nc">&nbsp;				RecetaMedica recetaMedica = recetaMedicaRepository.findByCodigo(codigoReceta).get();</b>
&nbsp;
<b class="nc">&nbsp;				Optional&lt;Medicamento&gt; optionalMedicamento = medicamentoRepository</b>
<b class="nc">&nbsp;						.findByCodigoyReceta(medicamento.getCodigo(), recetaMedica.getId());</b>
<b class="nc">&nbsp;				if (optionalMedicamento.isPresent()) {</b>
<b class="nc">&nbsp;					throw new RuntimeException(medicamento.getCodigo() + &quot; este medicamento ya existe en la receta&quot;);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				medicamento.setRecetaMedica(recetaMedica);</b>
&nbsp;
<b class="nc">&nbsp;				medicamento.persist();</b>
&nbsp;
<b class="nc">&nbsp;				response.add(medicamentoFactory.createResponseFromEntity(medicamento));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			return response;</b>
&nbsp;
<b class="nc">&nbsp;		} catch (CustomServerException e) {</b>
<b class="nc">&nbsp;			throw new CustomServerException(&quot;Error al crear los medicamentos&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Transactional
&nbsp;	public MedicamentoResponseDto updateMedicamento(String codigoMedicamento, Long idReceta, MedicamentoRequestDto dto)
&nbsp;			throws CustomServerException {
&nbsp;
&nbsp;		try {
&nbsp;
<b class="nc">&nbsp;			Optional&lt;Medicamento&gt; optionalMedicamento = medicamentoRepository.findByCodigoyReceta(codigoMedicamento,</b>
&nbsp;					idReceta);
&nbsp;
<b class="nc">&nbsp;			if (optionalMedicamento.isPresent()) {</b>
&nbsp;
<b class="nc">&nbsp;				DataValidator.validateDtoFields(dto);</b>
<b class="nc">&nbsp;				if (!MedicamentoValidator.validateRequestDto(dto)) {</b>
<b class="nc">&nbsp;					throw new InvalidDataRequest(&quot;Los datos de medicamento enviados son err√≥neos&quot;);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				Medicamento medicamento = optionalMedicamento.get();</b>
&nbsp;
<b class="nc">&nbsp;				medicamento</b>
<b class="nc">&nbsp;						.setCodigo(dto.getNombre() + &quot;-&quot; + dto.getConcentracion() + &quot;-&quot; + dto.getFormaFarmaceutica());</b>
<b class="nc">&nbsp;				medicamento.setNombre(dto.getNombre());</b>
<b class="nc">&nbsp;				medicamento.setConcentracion(dto.getConcentracion());</b>
<b class="nc">&nbsp;				medicamento.setFormaFarmaceutica(dto.getFormaFarmaceutica());</b>
<b class="nc">&nbsp;				medicamento.setFrecuencia(dto.getFrecuencia());</b>
<b class="nc">&nbsp;				medicamento.setDuracion(dto.getDuracion());</b>
<b class="nc">&nbsp;				medicamento.setInstrucciones(dto.getInstrucciones());</b>
&nbsp;
<b class="nc">&nbsp;				return this.medicamentoFactory.createResponseFromEntity(medicamento);</b>
&nbsp;			} else {
<b class="nc">&nbsp;				throw new EntityNotFoundException(&quot;Medicamento no encontrado&quot;);</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;		} catch (CustomServerException e) {</b>
<b class="nc">&nbsp;			throw new CustomServerException(&quot;Error al actualizar los medicamentos&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Transactional
&nbsp;	public void deleteMedicamento(String codigoMedicamento, Long idReceta) throws CustomServerException {
&nbsp;		
&nbsp;		try {
&nbsp;			
<b class="nc">&nbsp;			int updatedRows = this.medicamentoRepository</b>
<b class="nc">&nbsp;					.update(&quot;estaEliminado = true WHERE codigo = ?1 and recetaMedica.id = ?2&quot;, codigoMedicamento, idReceta);</b>
<b class="nc">&nbsp;			if (updatedRows == 0) {</b>
<b class="nc">&nbsp;				throw new EntityNotFoundException(&quot;Medicamento no encontrado&quot;);</b>
&nbsp;			}
&nbsp;			
<b class="nc">&nbsp;		}catch(CustomServerException e) {</b>
<b class="nc">&nbsp;			throw new CustomServerException(&quot;Error al eliminar un medicamento&quot;);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;		
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-06-16 12:42</div>
</div>
</body>
</html>
